stages:
    - deploy


deploy-job:
    stage: deploy
    only:
        - develop
    before_script:
        - 'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )'
        - echo "$SSH_PRIVATE_KEY" | tr -d "\r" | ssh-add -
        - mkdir -p ~/.ssh
        - chmod 700 ~/.ssh
        - ssh-keyscan -H 217.114.11.158 >> ~/.ssh/known_hosts
    script:
        - ssh root@217.114.11.158 '
            cd ~/backend/user-service &&
            git switch develop &&
            git pull origin develop &&

            cd ~/backend &&
            docker compose build --no-cache &&
            docker compose up
            '